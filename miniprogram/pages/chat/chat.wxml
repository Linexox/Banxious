<view class="container">
  
  <!-- 1. Healing Progress Bar -->
  <view class="progress-container">
    <image class="progress-icon left" src="../../images/banana_green.png" mode="aspectFit" wx:if="{{false}}"></image> <!-- Placeholder check -->
    <view class="progress-icon-placeholder left" style="background-color: {{progress < 100 ? '#4CAF50' : '#FFEB3B'}}"></view>
    
    <view class="progress-track">
      <view class="progress-fill" style="width: {{progress}}%;"></view>
    </view>
    
    <view class="progress-icon-placeholder right" style="background-color: #FFEB3B"></view>
  </view>

  <!-- 2. Main Chat Area -->
  <scroll-view 
    class="chat-list" 
    scroll-y 
    scroll-into-view="{{toView}}"
    scroll-with-animation
    enable-flex="true"
  >
    <view class="chat-content">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="chat-message-item" wx:if="{{item.content || item.role === 'user'}}">
          <chat-message msg="{{item}}"></chat-message>
        </view>
      </block>

      <view class="ai-typing-container" wx:if="{{loading && messages[messages.length-1].role === 'assistant' && !messages[messages.length-1].content}}">
         <view class="typing-bubble left">
            <view class="dot"></view><view class="dot"></view><view class="dot"></view>
         </view>
      </view>
      
      <!-- 3. Suggestions Layer (Moved into flow) -->
      <view class="suggestions-layer" wx:if="{{suggestions.length > 0 && !loading}}">
        <view 
          class="suggestion-bubble" 
          wx:for="{{suggestions}}" 
          wx:key="index" 
          bindtap="onSuggestionTap" 
          data-text="{{item}}"
        >
          <text>{{item}}</text>
        </view>
      </view>
      
      <view id="bottom" style="height: 1px; width: 100%"></view>
    </view>
  </scroll-view>

  <!-- 4. Cats Layer -->
   <view class="user-typing-layer" wx:if="{{isUserTyping}}">
      <view class="typing-bubble right">
        <view class="dot"></view><view class="dot"></view><view class="dot"></view>
      </view>
   </view>

  <!-- 4. Cats Layer -->
  <view class="cats-layer">
    <view class="ai-cat-container">
      <view class="cat-avatar ai {{isTalking ? 'talking' : ''}}">
        <text>üê±</text>
      </view>
    </view>

    <view class="user-cat-container">
      <view class="cat-avatar user {{isUserTyping ? 'typing' : ''}}">
        <text>üò∫</text>
      </view>
    </view>
  </view>

  <!-- 5. Input Area -->
  <view class="input-area">
    <chat-input bind:send="onSend" bind:typing="onUserTyping" disabled="{{loading}}"></chat-input>
  </view>

</view>
