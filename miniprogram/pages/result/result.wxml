<view class="container night-mode">
  <!-- å§‹ç»ˆå­˜åœ¨çš„ Canvasï¼Œç”¨äºåŠ¨ç”»ï¼Œå±‚çº§æœ€é«˜ä½†åˆå§‹éšè— -->
  <canvas type="2d" id="destroyCanvas" class="destroy-canvas" 
    style="visibility: {{isDestroying ? 'visible' : 'hidden'}}; pointer-events: {{isDestroying ? 'auto' : 'none'}};"
    bindtouchstart="onCanvasTouchStart"
    bindtouchmove="onCanvasTouchMove"
    bindtouchend="onCanvasTouchEnd"
  ></canvas>

  <view wx:if="{{loading}}" class="loading-text">
    <text>æ­£åœ¨æå–ç„¦è™‘æ ·æœ¬...</text>
  </view>

  <view wx:elif="{{errorMsg}}" class="error-container">
    <text class="error-text">âš ï¸ {{errorMsg}}</text>
    <button class="retry-btn" bindtap="generateCard">é‡è¯•</button>
  </view>

  <view wx:elif="{{cardData}}" class="card-container" bindtap="onFlipCard">
    <view class="card-flipper {{isFlipped ? 'flipped' : ''}}" style="opacity: {{isDestroying ? 0 : 1}};">
      
      <!-- æ­£é¢ -->
      <view class="card card-front">
        <view class="card-header">
          <text class="tag">{{cardData.mood_tag}}</text>
        </view>
        <view class="card-body">
          <text class="encouragement">{{cardData.encouragement}}</text>
          <view class="hint">ğŸ‘† ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹å»ºè®®</view>
        </view>
        <view class="card-footer">
          <text class="quote">â€œ{{cardData.healing_quote}}â€</text>
        </view>
      </view>

      <!-- åé¢ -->
      <view class="card card-back">
        <view class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
          <view class="toggle-btn" catchtap="onToggleAnalysis">
            <text>{{showProfessionalAnalysis ? 'è¿”å›ç®€ç•¥' : 'æ·±åº¦åˆ†æ'}}</text>
          </view>
          <text class="tag">{{showProfessionalAnalysis ? 'ä¸“ä¸šè§£è¯»' : 'Mood Lab å»ºè®®'}}</text>
        </view>
        
        <view class="card-body">
          <!-- ç®€ç•¥å»ºè®® -->
          <view class="suggestion-list" wx:if="{{!showProfessionalAnalysis}}">
            <block wx:for="{{cardData.suggestions}}" wx:key="index">
              <view class="suggestion-item">
                <text class="bullet">â€¢</text>
                <text class="content">{{item}}</text>
              </view>
            </block>
          </view>
          
          <!-- æ·±åº¦åˆ†æ -->
          <scroll-view wx:else scroll-y class="analysis-scroll">
            <text class="analysis-text" user-select>{{cardData.professional_analysis || 'æš‚æ— æ·±åº¦åˆ†æå†…å®¹ã€‚è¯·å°è¯•ä½¿ç”¨ä¸“ä¸šæ¨¡å¼å¯¹è¯åç”Ÿæˆã€‚'}}</text>
          </scroll-view>
        </view>

        <view class="card-footer">
          <text class="quote">â€œ{{cardData.healing_quote}}â€</text>
        </view>
      </view>

    </view>
  </view>

  <view wx:if="{{!loading && !isDestroying && !errorMsg}}" class="action-area">
    <view class="destroy-options">
      <view class="destroy-btn-wrapper" bindtap="onTear">
        <view class="destroy-icon-btn tear">âœ‚ï¸</view>
        <text class="destroy-label">æ’•ç¢</text>
      </view>
      <view class="destroy-btn-wrapper" bindtap="onBurn">
        <view class="destroy-icon-btn burn">ğŸ”¥</view>
        <text class="destroy-label">çƒ§æ¯</text>
      </view>
      <view class="destroy-btn-wrapper" bindtap="onCrush">
        <view class="destroy-icon-btn crush">ğŸ’¥</view>
        <text class="destroy-label">ç²‰ç¢</text>
      </view>
    </view>
  </view>
  
  <view wx:if="{{destroyed}}" class="ashes">
    <text>âœ¨</text>
  </view>
</view>
